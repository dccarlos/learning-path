



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.3.0">
    
    
      
        <title>Introduction to Avro - My learning path</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.572ca0f0.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../../../assets/javascripts/modernizr.962652e9.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#introduction-to-apache-avro" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="My learning path" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                My learning path
              </span>
              <span class="md-header-nav__topic">
                Introduction to Avro
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="My learning path" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    My learning path
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Software Engineering
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Software Engineering
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      DevOps
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        DevOps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../soft-eng/devops/introduction/" title="Introduction to DevOps" class="md-nav__link">
      Introduction to DevOps
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      BigData
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        BigData
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1" checked>
    
    <label class="md-nav__link" for="nav-3-1">
      Apache Avro
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Apache Avro
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Introduction to Avro
      </label>
    
    <a href="./" title="Introduction to Avro" class="md-nav__link md-nav__link--active">
      Introduction to Avro
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#whats-apache-avro" title="What's Apache Avro?" class="md-nav__link">
    What's Apache Avro?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-a-new-data-serialization-system" title="Why a new data serialization system?" class="md-nav__link">
    Why a new data serialization system?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schemas" title="Schemas" class="md-nav__link">
    Schemas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schema-resolution" title="Schema resolution" class="md-nav__link">
    Schema resolution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#avro-data-types-and-schemas" title="Avro Data Types and Schemas" class="md-nav__link">
    Avro Data Types and Schemas
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generic-mapping" title="Generic Mapping" class="md-nav__link">
    Generic Mapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specific-mapping" title="Specific Mapping" class="md-nav__link">
    Specific Mapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reflect-mapping-java-specific-one" title="Reflect Mapping (Java specific one)" class="md-nav__link">
    Reflect Mapping (Java specific one)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-memory-serialization-and-deserialization" title="In-Memory Serialization and Deserialization" class="md-nav__link">
    In-Memory Serialization and Deserialization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avro-datafiles" title="Avro Datafiles" class="md-nav__link">
    Avro Datafiles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-resolution_1" title="Schema Resolution" class="md-nav__link">
    Schema Resolution
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#projection-or-sub-schema" title="Projection or sub-schema" class="md-nav__link">
    Projection or sub-schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rules-of-resolution" title="Rules of resolution" class="md-nav__link">
    Rules of resolution
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sort-order" title="Sort Order" class="md-nav__link">
    Sort Order
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#whats-apache-avro" title="What's Apache Avro?" class="md-nav__link">
    What's Apache Avro?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-a-new-data-serialization-system" title="Why a new data serialization system?" class="md-nav__link">
    Why a new data serialization system?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schemas" title="Schemas" class="md-nav__link">
    Schemas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#schema-resolution" title="Schema resolution" class="md-nav__link">
    Schema resolution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#avro-data-types-and-schemas" title="Avro Data Types and Schemas" class="md-nav__link">
    Avro Data Types and Schemas
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generic-mapping" title="Generic Mapping" class="md-nav__link">
    Generic Mapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specific-mapping" title="Specific Mapping" class="md-nav__link">
    Specific Mapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reflect-mapping-java-specific-one" title="Reflect Mapping (Java specific one)" class="md-nav__link">
    Reflect Mapping (Java specific one)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-memory-serialization-and-deserialization" title="In-Memory Serialization and Deserialization" class="md-nav__link">
    In-Memory Serialization and Deserialization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avro-datafiles" title="Avro Datafiles" class="md-nav__link">
    Avro Datafiles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schema-resolution_1" title="Schema Resolution" class="md-nav__link">
    Schema Resolution
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#projection-or-sub-schema" title="Projection or sub-schema" class="md-nav__link">
    Projection or sub-schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rules-of-resolution" title="Rules of resolution" class="md-nav__link">
    Rules of resolution
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sort-order" title="Sort Order" class="md-nav__link">
    Sort Order
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="introduction-to-apache-avro"><strong>Introduction to Apache Avro</strong></h1>
<h2 id="whats-apache-avro"><strong>What's Apache Avro?</strong></h2>
<p>Apache Avro is a language-neutral data serialization system. The project was created by Doug Cutting (the creator of Hadoop) to address the major downside of Hadoop Writables: lack of language portability.</p>
<h2 id="why-a-new-data-serialization-system">Why a new data serialization system?</h2>
<p>Avro has a set of features that, taken together, differentiate it from other systems such as Apache Thrift or Google’s Protocol Buffers. Like in these systems and others, Avro data is described using a language-independent <em>schema</em>. However, <strong><em>unlike in some other systems, code generation is optional in Avro, which means you can read and write data that conforms to a given schema even if your code has not seen that particular schema before</em></strong>. To achieve this, Avro assumes that the schema is always present—at both read and write time—which makes for a very compact encoding, since encoded values do not need to be tagged with a field identifier.</p>
<p><strong>With</strong> code-generation usually means that <em>before</em> compiling your Java application, you have an Avro schema available. You, as a developer, will use an Avro compiler to generate a class for each record in the schema and you use these classes in your application.</p>
<p>In the referenced link, the author does this: <code>java -jar avro-tools-1.7.5.jar compile schema student.avsc</code>, and then uses the <code>student_marks</code> class directly.</p>
<p>In this case, each instance of the class <code>student_marks</code> inherits from <code>SpecificRecord</code>, with custom methods for accessing the data inside (such as <code>getStudentId()</code> to fetch the <code>student_id</code> field).</p>
<p><strong>Without</strong> code-generation usually means that your application doesn't have any specific necessary schema (for example, it can treat different kinds of data).</p>
<p>In this case, there's no <code>student</code> class generated, but you can still read Avro records in an Avro container. You won't have instances of <code>student</code>, but instances of <code>GenericRecord</code>. There won't be any helpful methods like <code>getStudentId()</code>, but you can use methods <code>get("student_marks")</code> or <code>get(0)</code>.</p>
<h2 id="schemas">Schemas</h2>
<p>Avro schemas are usually written in JSON, and data is usually encoded using a binary format, but there are other options, too. There is a higher-level language called <em>Avro IDL</em> for writing schemas in a C-like language that is more familiar to developers. There is also a JSON-based data encoder, which, being human readable, is useful for prototyping and debugging Avro data.</p>
<p>The <em>Avro specification</em> precisely defines the binary format that all implementations must support. It also specifies many of the other features of Avro that implementations should support. One area that the specification does not rule on, however, is APIs: implementations have complete latitude in the APIs they expose for working with Avro data, since each one is necessarily language specific.</p>
<h2 id="schema-resolution">Schema resolution</h2>
<p>Within certain carefully defined constraints, the schema used to read data need not be identical to the schema that was used to write the data. This is the mechanism by which Avro supports schema evolution. For example, a new, optional field may be added to a record by declaring it in the schema used to read the old data. New and old clients alike will be able to read the old data, while new clients can write new data that uses the new field. Conversely, if an old client sees newly encoded data, it will gracefully ignore the new field and carry on processing as it would have done with old data. </p>
<p>Avro specifies an <em>object container format</em> for sequences of objects, similar to Hadoop’s sequence file. An <em>Avro datafile</em> has a metadata section where the schema is stored, which makes the file self-describing. Avro datafiles support compression and are splittable, which is crucial for a MapReduce data input format. In fact, support goes beyond MapReduce: all of the data processing frameworks in this book (Pig, Hive, Crunch, Spark) can read and write Avro datafiles.</p>
<h2 id="avro-data-types-and-schemas">Avro Data Types and Schemas</h2>
<p><img alt="Screen Shot 2019-06-02 at 1.15.26 PM" src="../avro-types.png" /></p>
<p><img alt="avro-complex-types" src="../avro-complex-types.png" /></p>
<p>Each Avro language API has a representation for each Avro type that is specific to the language. For example, Avro’s <code>double</code> type is represented in C, C++, and Java by a <code>double</code>, in Python by a <code>float</code>, and in Ruby by a <code>Float</code>.</p>
<h3 id="generic-mapping">Generic Mapping</h3>
<p>All languages support a dynamic mapping, which can be used even when the schema is not known ahead of runtime.</p>
<h3 id="specific-mapping">Specific Mapping</h3>
<p>The Java and C++ implementations can generate code to represent the data for an Avro schema. It is an optimization that is useful when you have a copy of the schema before you read or write data. Generated classes also provide a more domain-oriented API for user code than Generic ones.</p>
<h3 id="reflect-mapping-java-specific-one">Reflect Mapping (Java specific one)</h3>
<p>Maps Avro types onto preexisting Java types using reflection. It is slower than the Generic and Specific mappings but can be a convenient way of defining a type, since Avro can infer a schema automatically.</p>
<p><img alt="avro-type-mappings-1" src="../avro-type-mappings-1.png" /></p>
<p><img alt="avro-type-mappings-2" src="/Users/carlosd/Documents/projects/src/learning-path/docs/bigdata/apache-avro/avro-type-mappings-2.png" /></p>
<blockquote>
<p>Avro string can be represented by either Java String or the Avro Utf8 Java type. The reason to use Utf8 is efficiency: because it is mutable, a single Utf8 instance may be reused for reading or writing a series of values. Also, Java String decodes UTF-8 at object construction time, whereas Avro Utf8 does it lazily, which can increase performance in some cases. Utf8 implements Java’s java.lang.CharSequence interface, which allows some interoperability with Java libraries. In other cases, it may be necessary to convert Utf8 instances to String objects by calling its toString() method. Utf8 is the default for Generic and Specific, but it’s possible to use String for a particular mapping. There are a couple of ways to achieve this. The first is to set the avro.java.string property in the schema to String: </p>
<p><code>json
{ "type": "string", "avro.java.string": "String" }</code></p>
</blockquote>
<h3 id="in-memory-serialization-and-deserialization">In-Memory Serialization and Deserialization</h3>
<pre><code class="java">    @Test
    public void testEncoderDecoder() throws IOException {
        System.out.println(&quot;Encode/Decode test&quot;);

        Schema.Parser parser = new Schema.Parser();
        Schema schema = parser.parse(getClass().getResourceAsStream(&quot;/avro/user.avsc&quot;));

        try (ByteArrayOutputStream outputStream = new ByteArrayOutputStream()) {
            DatumWriter&lt;GenericRecord&gt; writer = new GenericDatumWriter&lt;&gt;(schema);

            GenericRecord user1 = new GenericData.Record(schema);
            user1.put(&quot;name&quot;, &quot;Armando&quot;);
            user1.put(&quot;favoriteNumber&quot;, 11);
            user1.put(&quot;favoriteColor&quot;, &quot;PINK&quot;);

            GenericRecord user2 = new GenericData.Record(schema);
            user2.put(&quot;name&quot;, &quot;Rosana&quot;);
            user2.put(&quot;favoriteNumber&quot;, 14);
            user2.put(&quot;favoriteColor&quot;, &quot;GREY&quot;);

            Encoder encoder = EncoderFactory.get().jsonEncoder(schema, outputStream);
            writer.write(user1, encoder);
            writer.write(user2, encoder);

            encoder.flush();

            final String jsonRecords = outputStream.toString();

            System.out.println(&quot;Encoded avro =&gt; json:\n&quot; + jsonRecords);

            DatumReader&lt;GenericRecord&gt; datumReader = new GenericDatumReader&lt;&gt;(schema);
            Decoder decoder = DecoderFactory.get().jsonDecoder(schema, jsonRecords);

            GenericRecord parsedUser1 = datumReader.read(null, decoder);
            GenericRecord parsedUser2 = datumReader.read(null, decoder);
            // GenericRecord parsedNull = datumReader.read(null, decoder); // &lt;= Exception!

            System.out.println();
            System.out.println(&quot;Decoded json =&gt; avro:&quot;);

            System.out.println(parsedUser1);
            System.out.println(parsedUser2);
        } catch (IOException ioe) {
            ioe.printStackTrace();
        }
    }
</code></pre>

<h3 id="avro-datafiles">Avro Datafiles</h3>
<p>Avro’s object container file format is for storing sequences of Avro objects. A datafile has a header containing metadata, including the Avro schema and a <em>sync marker</em>, followed by a series of (optionally compressed) blocks containing the serialized Avro objects. Blocks are separated by a sync marker that is unique to the file (the marker for a particular file is found in the header) and that permits rapid resynchronization with a block boundary after seeking to an arbitrary point in the file, such as an HDFS block boundary. Thus, Avro datafiles are splittable.</p>
<h3 id="schema-resolution_1">Schema Resolution</h3>
<p>We can choose to use a different schema for reading the data back (the <em>reader’s schema</em>) from the one we used to write it (the <em>writer’s schema</em>). This is a powerful tool because it enables schema evolution. To illustrate, consider a new schema for string pairs with an added <code>description</code> field:</p>
<pre><code class="json">{
    &quot;type&quot;: &quot;record&quot;,
    &quot;name&quot;: &quot;StringPair&quot;,
    &quot;doc&quot;: &quot;A pair of strings with an added field.&quot;, 
  &quot;fields&quot;: [
        {&quot;name&quot;: &quot;left&quot;, &quot;type&quot;: &quot;string&quot;},
        {&quot;name&quot;: &quot;right&quot;, &quot;type&quot;: &quot;string&quot;},
        {&quot;name&quot;: &quot;description&quot;, &quot;type&quot;: &quot;string&quot;, &quot;default&quot;: &quot;&quot;}
    ]
}
</code></pre>

<p>We can use this schema to read the data we serialized earlier because, crucially, we have given the <code>description</code> field a default value (the empty string), which Avro will use when there is no such field defined in the records it is reading. Had we omitted the <code>default</code> attribute, we would get an error when trying to read the old data.</p>
<blockquote>
<p>To make the default value <code>null</code> rather than the empty string, we would instead define the <code>description</code> field using a union with the <code>null</code> Avro type:</p>
<p><code>json
{"name": "description", "type": ["null", "string"], "default": null}</code></p>
</blockquote>
<p>When the reader’s schema is different from the writer’s, we use the constructor for <code>GenericDatumReader</code> that takes two schema objects, the writer’s and the reader’s, in that order:</p>
<pre><code class="java">DatumReader&lt;GenericRecord&gt; reader = new GenericDatumReader&lt;GenericRecord&gt;(schema, newSchema);
Decoder decoder = DecoderFactory.get().binaryDecoder(out.toByteArray(), null);
GenericRecord result = reader.read(null, decoder);
assertThat(result.get(&quot;left&quot;).toString(), is(&quot;L&quot;));
assertThat(result.get(&quot;right&quot;).toString(), is(&quot;R&quot;));
assertThat(result.get(&quot;description&quot;).toString(), is(&quot;&quot;));
</code></pre>

<p>For datafiles, which have the writer’s schema stored in the metadata, we only need to specify the reader’s schema explicitly, which we can do by passing <code>null</code> for the writer’s schema:</p>
<pre><code class="java">DatumReader&lt;GenericRecord&gt; reader = new GenericDatumReader&lt;GenericRecord&gt;(null, newSchema);
</code></pre>

<h4 id="projection-or-sub-schema">Projection or sub-schema</h4>
<p>Another common use of a different reader’s schema is to drop fields in a record, an operation called <em>projection</em>. This is useful when you have records with a large number of fields and you want to read only some of them. For example, this schema can be used to get only the <code>right</code> field of a <code>StringPair</code>:</p>
<pre><code class="json">{
    &quot;type&quot;: &quot;record&quot;,
    &quot;name&quot;: &quot;StringPair&quot;,
    &quot;doc&quot;: &quot;A pair of strings with an added field.&quot;, 
  &quot;fields&quot;: [
        {&quot;name&quot;: &quot;right&quot;, &quot;type&quot;: &quot;string&quot;}
    ]
}
</code></pre>

<h4 id="rules-of-resolution">Rules of resolution</h4>
<p>The rules for schema resolution have a direct bearing on how schemas may evolve from one version to the next, and are spelled out in the Avro specification for all Avro types.</p>
<p><img alt="schema-resolution" src="../schema-resolution.png" /></p>
<p>Another useful technique for evolving Avro schemas is the use of name <em>aliases</em>. Aliases allow you to use different names in the schema used to read the Avro data than in the schema originally used to write the data. For example, the following reader’s schema can be used to read <code>StringPair</code> data with the new field names <code>first</code> and <code>second</code> instead of <code>left</code> and <code>right</code>(which are what it was written with):</p>
<pre><code class="json">{
    &quot;type&quot;: &quot;record&quot;,
    &quot;name&quot;: &quot;StringPair&quot;,
    &quot;doc&quot;: &quot;A pair of strings with an added field.&quot;, 
  &quot;fields&quot;: [
        {&quot;name&quot;: &quot;first&quot;, &quot;type&quot;: &quot;string&quot;, &quot;aliases&quot;: [&quot;left&quot;]},
        {&quot;name&quot;: &quot;second&quot;, &quot;type&quot;: &quot;string&quot;, &quot;aliases&quot;: [&quot;right&quot;]}
    ]
}
</code></pre>

<p>Note that the aliases are used to translate (at read time) the writer’s schema into the reader’s, but the alias names are not available to the reader. In this example, the reader cannot use the field names <code>left</code> and <code>right</code>, because they have already been translated to <code>first</code> and <code>second</code>.</p>
<h3 id="sort-order">Sort Order</h3>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../../soft-eng/devops/introduction/" title="Introduction to DevOps" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Introduction to DevOps
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.a353778b.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
  </body>
</html>